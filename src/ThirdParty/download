#! /usr/bin/perl
##  by Paul Hines

## This script can be used to download (most) of the third party sofware needed for phines' projects

use Cwd;
my $wdir = cwd;

# download Coin-Bonmin
print "Attempting to download the Coin-OR source code\n";
if (-d "Coin-Bonmin") {
	#print "Updating the local copy of the Coin-Bonmin source.\n";
	#system("svn cleanup Coin-Bonmin")==0 or die "could not do cleanup.\n";
	#system("svn update  Coin-Bonmin")==0 or die "could not update Coin-Bonmin.\n";
} else {
	print "Attempting to check out a copy of the Coin source code.\n";
	system("svn co https://projects.coin-or.org/svn/Bonmin/trunk Coin-Bonmin")==0 or die "Could not get check out the Coin source.\n";
}

# download lapack
print "Attempting to download source code for lapack.\n";
chdir "Coin-Bonmin/ThirdParty/Lapack";
system "./get.Lapack" unless (-e "LAPACK/SRC");
chdir "$wdir";

# download ASL
print "Attempting to download source code for ASL.\n";
chdir "Coin-Bonmin/ThirdParty/ASL";
system "./get.ASL" unless (-e "solvers");
chdir "$wdir";

# check for HSL
print "Checking for the HSL files.\n";
my $f;
if ($f = glob <"coinhsl*.zip">) {
	# strip off the file extension
	$f =~ m/(coinhsl.*?)\.zip/;
	my $dir=$1;
	# prepare things
	print "Preparing the HSL files\n";
	system("cp $f Coin-Bonmin/ThirdParty/HSL/")==0 or die;
	chdir "Coin-Bonmin/ThirdParty/HSL" or die;
	system("unzip $f")==0 or die;
	system("ln -s $dir coinhsl")==0 or die;
	chdir "$wdir";
} elsif ($f = glob <"coinhsl*.tar.gz">) {
	# strip off the file extension
	$f =~ m/(coinhsl.*?)\.zip/;
	my $dir=$1;
	# finish up
	print "Preparing the HSL files\n";
	system("mv $f Coin-Bonmin/ThirdParty/HSL/")==0 or die;
	chdir "../Coin-Bonmin/ThirdParty/HSL";
	system("tar xfvz $f")==0 or die;
	system("ln -s $f $dir")==0 or die;
	chdir "$wdir";
} else {
	die "Could not find the HSL files. Grab these before installing.";
}
#chdir "HSL";
#unless (-e "mc19ad.f") {
#	die "Before trying to configure the ThirdParty directory, you will need to download the HSL files.\n";
#}

# download SparseSuite
print "Checking for SparseSuite.\n";
unless (-e "SuiteSparse-4.5.3.tar.gz") {
	system("wget http://faculty.cse.tamu.edu/davis/SuiteSparse/SuiteSparse-4.5.3.tar.gz");
	system("tar xvfz SuiteSparse-4.5.3.tar.gz")
}

print "Everything downloaded.\n";
exit 0;
